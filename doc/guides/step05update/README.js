Ext.data.JsonP.step05update({"guide":"<h2 id='step05update-section-step.5-%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E6%9B%B4%E6%96%B0'>Step.5 データの更新</h2>\n\n<h3 id='step05update-section-proxy-%E3%81%AE%E8%A8%AD%E5%AE%9A'>proxy の設定</h3>\n\n<p><strong>app/model/List.js</strong></p>\n\n<pre><code>proxy: {\n    type: 'direct',\n    api: {\n        read: 'MyList.rpc.MyList.getList',\n        create: 'MyList.rpc.MyList.createData',\n        update: 'MyList.rpc.MyList.updateData',\n        destroy: 'MyList.rpc.MyList.removeData'\n    },\n    reader: {\n        type: 'json',\n        rootProperty: 'data'\n    },\n    writer: {\n        type: 'json'\n    }\n}\n</code></pre>\n\n<ul>\n<li><code>proxy</code></li>\n<li><code>type</code></li>\n<li><code>api</code> コンフィグに CRUD それぞれのメソッドを設定</li>\n<li><code>model</code> 単体での更新を設定</li>\n<li><code>reader</code></li>\n<li><code>writer</code></li>\n</ul>\n\n\n<h3 id='step05update-section-%E7%B7%A8%E9%9B%86%E3%81%AE%E6%9B%B4%E6%96%B0'>編集の更新</h3>\n\n<p>update がかかる</p>\n\n<p><strong>app/view/main/MainController.js</strong></p>\n\n<pre><code>onSubmit: function() {\n    var me = this,\n        list = me.lookupReference('mylist'),\n        edit = me.lookupReference('myedit'),\n        data = edit.getViewModel().getData();\n\n    data.rec.save();\n    me.setActiveItem(list);\n},\n</code></pre>\n\n<ul>\n<li><code>save</code> メソッド</li>\n<li>ダーティマークが消える</li>\n<li>リロードしてもデータが変わっている</li>\n</ul>\n\n\n<h3 id='step05update-section-%E8%BF%BD%E5%8A%A0'>追加</h3>\n\n<p><strong>app/view/main/MainController.js</strong></p>\n\n<pre><code>onAddList: function() {\n    var me = this,\n        list = me.lookupReference('mylist'),\n        edit = me.lookupReference('myedit'),\n        vmodel = edit.getViewModel();\n\n    vmodel.setData({\n        rec: Ext.create('MyList.model.List')\n    });\n    edit.reset();\n    me.setActiveItem(edit);\n},\n</code></pre>\n\n<ul>\n<li>Edit に切り替える前に空のレコードをセット</li>\n<li>id がない = phantom</li>\n<li><code>save</code> で create が走る</li>\n</ul>\n\n\n<h3 id='step05update-section-%E5%89%8A%E9%99%A4'>削除</h3>\n\n<p><strong>app/view/main/MainController.js</strong></p>\n\n<pre><code>onRemoveList: function() {\n    var me = this,\n        list = me.lookupReference('mylist'),\n        selected = list.getSelection();\n\n    if( selected.length &gt; 0 ) {\n        selected[0].erase();\n    }\n\n},\n</code></pre>\n\n<ul>\n<li><code>erase</code> メソッド</li>\n<li>ボタンの活性が変化するのも確認</li>\n</ul>\n\n\n<h3 id='step05update-section-%E3%82%AD%E3%83%A3%E3%83%B3%E3%82%BB%E3%83%AB'>キャンセル</h3>\n\n<p><strong>app/view/main/MainController.js</strong></p>\n\n<pre><code>onCancel: function() {\n    var me = this,\n        list = me.lookupReference('mylist'),\n        edit = me.lookupReference('myedit'),\n        rec = edit.getViewModel().getData().rec;\n\n    if( !rec || rec.phantom ) {\n        edit.reset();\n    } else {\n        rec.load(rec.get('id'));\n    }\n    me.setActiveItem(list);\n\n}\n</code></pre>\n","title":"Step.5 データの更新"});